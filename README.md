# Rustdoc to org
A Pandoc filter that converts rust documentation to .org-files! This is still in a very early state and there are many improvements to work on, hopefully this can end up helping someone.
![Demo with helm ag](demo.gif)
## Installation
### Binary
* Install Pandoc https://pandoc.org/
* Download and install rustdoc-to-org: `wget https://github.com/samhedin/rustdoc-to-org/releases/download/v0.1/rustdoc-to-org-exe; cp rustdoc-to-org-exe ~/.local/usr/bin`, make sure that `~/.local/usr/bin` is in your `PATH`.
* Locate a rustdoc html file you wish to convert, and run `pandoc <file> --filter rustoc-to-org-exe -o outfile.org`

### Batch convert
* Generate all `.html` files for std by running `rustup doc`, which will put the files somewhere in `~/.rustup/`, in my case in `~/.rustup/toolchains/stable-x86_64-unknown-linux-gnu/share/doc/rust/html/std/)`.
* Convert all of them with `sh batch_convert.sh <input_dir> <output_dir>`.
* You can also convert docs generated by `cargo doc`

## Interacting with the documents
I use it with [Helm ag](https://github.com/bridgesense/emacs-helm-ag):
* Install ripgrep
* In the snippet below, change the first argument to `helm-ag` to whatever outdir you used when running `batch_convert.sh`.
``` emacs-lisp
(defun search-rustdoc (search-term)
"Search directory for SEARCH-TERM.
Provide `prefix-arg` to only search for Level 1 headers, which greatly limits the number of search results.
Useful if you want to search for the name of a Struct, Enum or Trait."
(interactive
 (list
  (read-string (format "search term, default (%s): " (thing-at-point 'symbol))
               nil nil (thing-at-point 'symbol))))

(let ((helm-ag-base-command "rg  --smart-case --no-heading --color=never --line-number")
      (regex (if current-prefix-arg
                 (progn
                   (setq current-prefix-arg nil)
                   "^\\* [^-]\*")
               "\\* [^-]\*")))

  (helm-ag "/home/sam/.emacs.d/private/rustdoc" (concat regex search-term))))

(global-set-key (kbd "C-x C-s") 'search-rustdoc)
```

## Development
* Install Haskell Stack https://docs.haskellstack.org/en/stable/README/
* Clone the project and get started!


## TODO
* Figure out a way to get links working. All links point to .html files, they should be updated to point to .org files.
* Make code not awful and not slow.
* Pandoc seems to be keen on inserting extra linebreaks between sections. For example, there is an extra linebreak after each header. It would be nice to remove this.
* There is a redundant title string before the actual Header title, which should be removed.
* Fill out this list.

All suggestions, comments and more are welcomed!
